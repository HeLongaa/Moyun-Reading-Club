"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[540],{2983:(e,o,t)=>{t.d(o,{A:()=>s});var a=t(3814);const s={getBooks:e=>a.A.get("/book",{params:e}),getBookDetail:e=>a.A.get(`/book/${e}`),getBookTypes:()=>a.A.get("/book/types"),createBook:e=>a.A.post("/book",e),updateBook:(e,o)=>a.A.put(`/book/${e}`,o),deleteBook:e=>a.A.delete(`/book/${e}`),uploadBookFile:(e,o)=>{const t=new FormData;return t.append("book",o),a.A.post(`/book/upload/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}})},uploadBookCover:(e,o)=>{const t=new FormData;return t.append("cover",o),a.A.post(`/book/upload-cover/${e}`,t,{headers:{"Content-Type":"multipart/form-data"}})}}},5540:(e,o,t)=>{t.r(o),t.d(o,{default:()=>R});var a=t(641),s=t(33),r=t(3751);const l={class:"explore-books"},n={class:"explore-header"},i=["value"],c={class:"pagination"},h=["disabled"],d=["disabled"];function u(e,o,t,u,k,p){const b=(0,a.g2)("BookSearcher"),m=(0,a.g2)("BookList");return(0,a.uX)(),(0,a.CE)("div",l,[(0,a.Lk)("div",n,[(0,a.bF)(b,{modelValue:k.search,"onUpdate:modelValue":o[0]||(o[0]=e=>k.search=e),onSearch:p.fetchBooks},null,8,["modelValue","onSearch"]),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":o[1]||(o[1]=e=>k.type=e),onChange:o[2]||(o[2]=(...e)=>p.fetchBooks&&p.fetchBooks(...e))},[o[5]||(o[5]=(0,a.Lk)("option",{value:""},"全部类型",-1)),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.types,(e=>((0,a.uX)(),(0,a.CE)("option",{key:e,value:e},(0,s.v_)(e),9,i)))),128))],544),[[r.u1,k.type]])]),(0,a.bF)(m,{books:k.books,onSelect:p.goDetail},null,8,["books","onSelect"]),(0,a.Lk)("div",c,[(0,a.Lk)("button",{disabled:1===k.page,onClick:o[3]||(o[3]=e=>k.page--&&p.fetchBooks())},"上一页",8,h),(0,a.Lk)("span",null,"第"+(0,s.v_)(k.page)+"页",1),(0,a.Lk)("button",{disabled:!p.hasMore,onClick:o[4]||(o[4]=e=>k.page++&&p.fetchBooks())},"下一页",8,d)])])}var k=t(2983);const p={class:"book-list"},b={class:"controls"},m={class:"books-grid"},g={key:0,class:"empty"};function y(e,o,t,s,r,l){const n=(0,a.g2)("BookSearch"),i=(0,a.g2)("FilterPanel"),c=(0,a.g2)("BookCard"),h=(0,a.g2)("Pagination");return(0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("div",b,[(0,a.bF)(n,{onSearch:l.handleSearch},null,8,["onSearch"]),(0,a.bF)(i,{onFilter:l.applyFilters},null,8,["onFilter"])]),(0,a.Lk)("div",m,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.displayedBooks,(o=>((0,a.uX)(),(0,a.Wv)(c,{key:o.id,book:o,onShare:e=>l.showSharePanel(o),onClick:t=>e.$emit("select",o)},null,8,["book","onShare","onClick"])))),128))]),(0,a.bF)(h,{current:r.currentPage,total:l.totalPages,onChange:l.changePage},null,8,["current","total","onChange"]),0===l.displayedBooks.length?((0,a.uX)(),(0,a.CE)("div",g,"暂无书籍")):(0,a.Q3)("",!0)])}var v=t(6278);const B={class:"book-title"},f={class:"book-author"},C={class:"book-type"};function S(e,o,t,r,l,n){return(0,a.uX)(),(0,a.CE)("div",{class:"book-card",onClick:o[0]||(o[0]=o=>e.$emit("click"))},[(0,a.Lk)("div",B,(0,s.v_)(t.book.title),1),(0,a.Lk)("div",f,(0,s.v_)(t.book.author),1),(0,a.Lk)("div",C,(0,s.v_)(t.book.type),1)])}const L={name:"BookCard",props:{book:{type:Object,required:!0}}};var w=t(6262);const F=(0,w.A)(L,[["render",S],["__scopeId","data-v-6bcf9ee7"]]),A=F,Q={components:{BookCard:A},data(){return{currentPage:1,filters:{},searchQuery:""}},computed:{...(0,v.aH)("books",["bookList","searchResults"]),displayedBooks(){return this.searchQuery?this.searchResults:this.bookList},totalPages(){return Math.ceil(this.displayedBooks.length/20)}},async created(){await this.fetchBooks(),await this.loadRecommendations()},methods:{...(0,v.i0)("books",["fetchBooks","searchBooks","loadRecommendations"]),handleSearch(e){this.searchQuery=e,this.searchBooks(e)},applyFilters(e){this.filters=e,this.fetchBooks({...e,page:this.currentPage})},changePage(e){this.currentPage=e,window.scrollTo(0,0)},showSharePanel(e){this.$modal.show("share-modal",{book:e})}}},$=(0,w.A)(Q,[["render",y],["__scopeId","data-v-0f9b5d14"]]),_=$,I={class:"book-searcher"},P={key:0,class:"search-results"};function X(e,o,t,s,l,n){const i=(0,a.g2)("BookCard");return(0,a.uX)(),(0,a.CE)("div",I,[(0,a.bo)((0,a.Lk)("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>l.searchQuery=e),onInput:o[1]||(o[1]=(...e)=>n.handleSearch&&n.handleSearch(...e)),placeholder:"搜索书名/作者/关键词...",class:"search-input"},null,544),[[r.Jo,l.searchQuery]]),(0,a.Lk)("button",{onClick:o[2]||(o[2]=(...e)=>n.onSearch&&n.onSearch(...e))},"搜索"),l.results.length>0?((0,a.uX)(),(0,a.CE)("div",P,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.results,(e=>((0,a.uX)(),(0,a.Wv)(i,{key:e.id,book:e,small:""},null,8,["book"])))),128))])):(0,a.Q3)("",!0)])}const E={props:{modelValue:String},emits:["update:modelValue","search"],data(){return{searchQuery:this.modelValue||"",results:[],timeoutId:null}},watch:{modelValue(e){this.searchQuery=e}},methods:{handleSearch(){this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout((async()=>{if(this.searchQuery.trim().length<2)return void(this.results=[]);const e=await this.$store.dispatch("books/searchBooks",this.searchQuery);this.results=e.slice(0,5)}),300)},onSearch(){this.$emit("update:modelValue",this.searchQuery),this.$emit("search",this.searchQuery)}}},V=(0,w.A)(E,[["render",X],["__scopeId","data-v-57b0d60f"]]),T=V,D={name:"Explore",components:{BookList:_,BookSearcher:T},data(){return{books:[],types:[],type:"",search:"",page:1,limit:10,total:0}},computed:{hasMore(){return this.page*this.limit<this.total}},async created(){await this.fetchTypes(),await this.fetchBooks()},methods:{async fetchTypes(){const e=await k.A.getBookTypes();this.types=e.data.data||[]},async fetchBooks(){const e={page:this.page,limit:this.limit,type:this.type,search:this.search},o=await k.A.getBooks(e);this.books=o.data.data.books||[],this.total=o.data.data.total||0},goDetail(e){this.$router.push(`/books/${e.id}`)}}},x=(0,w.A)(D,[["render",u],["__scopeId","data-v-df124522"]]),R=x}}]);
//# sourceMappingURL=540.f969c441.js.map