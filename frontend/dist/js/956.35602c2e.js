"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[956],{2956:(e,l,t)=>{t.r(l),t.d(l,{default:()=>p});var i=t(641),a=t(3751);const r={class:"circle-settings"};function n(e,l,t,n,d,o){const s=(0,i.g2)("el-input"),u=(0,i.g2)("el-form-item"),m=(0,i.g2)("el-button"),c=(0,i.g2)("el-form"),b=(0,i.g2)("member-list"),h=(0,i.g2)("el-divider"),p=(0,i.g2)("el-popconfirm");return(0,i.uX)(),(0,i.CE)("div",r,[l[4]||(l[4]=(0,i.Lk)("h2",null,"学习圈设置",-1)),(0,i.bF)(c,{model:d.form,"label-width":"120px",onSubmit:(0,a.D$)(o.handleSubmit,["prevent"])},{default:(0,i.k6)((()=>[(0,i.bF)(u,{label:"圈子名称"},{default:(0,i.k6)((()=>[(0,i.bF)(s,{modelValue:d.form.name,"onUpdate:modelValue":l[0]||(l[0]=e=>d.form.name=e)},null,8,["modelValue"])])),_:1}),(0,i.bF)(u,{label:"圈子描述"},{default:(0,i.k6)((()=>[(0,i.bF)(s,{modelValue:d.form.description,"onUpdate:modelValue":l[1]||(l[1]=e=>d.form.description=e),type:"textarea",rows:3},null,8,["modelValue"])])),_:1}),(0,i.bF)(u,null,{default:(0,i.k6)((()=>[(0,i.bF)(m,{type:"primary","native-type":"submit",loading:d.loading},{default:(0,i.k6)((()=>l[2]||(l[2]=[(0,i.eW)(" 保存设置 ")]))),_:1,__:[2]},8,["loading"])])),_:1})])),_:1},8,["model","onSubmit"]),l[5]||(l[5]=(0,i.Lk)("h3",null,"成员管理",-1)),(0,i.bF)(b,{members:d.members,onUpdateRole:o.handleUpdateRole},null,8,["members","onUpdateRole"]),(0,i.bF)(h),(0,i.bF)(p,{title:"确定要删除这个圈子吗？",onConfirm:o.handleDeleteCircle},{default:(0,i.k6)((()=>[(0,i.bF)(m,{slot:"reference",type:"danger",loading:d.deleting},{default:(0,i.k6)((()=>l[3]||(l[3]=[(0,i.eW)(" 删除圈子 ")]))),_:1,__:[3]},8,["loading"])])),_:1},8,["onConfirm"])])}var d=t(6278);function o(e,l,t,a,r,n){const d=(0,i.g2)("el-table-column"),o=(0,i.g2)("el-option"),s=(0,i.g2)("el-select"),u=(0,i.g2)("el-button"),m=(0,i.g2)("el-table");return(0,i.uX)(),(0,i.CE)("div",null,[(0,i.bF)(m,{data:t.members,style:{width:"100%"}},{default:(0,i.k6)((()=>[(0,i.bF)(d,{prop:"username",label:"成员"}),(0,i.bF)(d,{prop:"role",label:"角色"},{default:(0,i.k6)((({row:e})=>[(0,i.bF)(s,{modelValue:e.role,"onUpdate:modelValue":l=>e.role=l,onChange:l=>n.handleRoleChange(e.id,l)},{default:(0,i.k6)((()=>[(0,i.bF)(o,{label:"普通成员",value:"member"}),(0,i.bF)(o,{label:"管理员",value:"admin"}),(0,i.bF)(o,{label:"创建者",value:"creator"})])),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),t.isOwner?((0,i.uX)(),(0,i.Wv)(d,{key:0,label:"操作"},{default:(0,i.k6)((({row:e})=>["pending"===e.state?((0,i.uX)(),(0,i.Wv)(u,{key:0,size:"mini",type:"success",onClick:l=>n.audit(e.id,!0)},{default:(0,i.k6)((()=>l[0]||(l[0]=[(0,i.eW)(" 通过 ")]))),_:2,__:[0]},1032,["onClick"])):(0,i.Q3)("",!0),"pending"===e.state?((0,i.uX)(),(0,i.Wv)(u,{key:1,size:"mini",type:"danger",onClick:l=>n.audit(e.id,!1)},{default:(0,i.k6)((()=>l[1]||(l[1]=[(0,i.eW)(" 拒绝 ")]))),_:2,__:[1]},1032,["onClick"])):(0,i.Q3)("",!0),"pending"!==e.state&&"creator"!==e.role?((0,i.uX)(),(0,i.Wv)(u,{key:2,size:"mini",type:"danger",onClick:l=>n.remove(e.id)},{default:(0,i.k6)((()=>l[2]||(l[2]=[(0,i.eW)(" 移除 ")]))),_:2,__:[2]},1032,["onClick"])):(0,i.Q3)("",!0)])),_:1})):(0,i.Q3)("",!0)])),_:1},8,["data"])])}const s={name:"MemberList",props:{members:{type:Array,required:!0},isOwner:{type:Boolean,default:!1}},methods:{handleRoleChange(e,l){this.$emit("update-role",{userId:e,role:l})},audit(e,l){this.$emit("audit",{userId:e,isOno:l})},remove(e){this.$emit("remove",e)}}};var u=t(6262);const m=(0,u.A)(s,[["render",o],["__scopeId","data-v-d8306b64"]]),c=m,b={name:"CircleSettings",components:{MemberList:c},data(){return{loading:!1,deleting:!1,form:{name:"",description:""},members:[]}},computed:{...(0,d.aH)("circles",["currentCircle"])},watch:{currentCircle:{immediate:!0,handler(e){e&&(this.form={name:e.name,description:e.description},this.fetchMembers())}}},methods:{...(0,d.i0)("circles",["updateCircle","fetchCircleMembers","updateMemberRole","deleteCircle"]),async fetchMembers(){const e=await this.fetchCircleMembers(this.currentCircle.id);this.members=e},async handleSubmit(){this.loading=!0;try{await this.updateCircle({circleId:this.currentCircle.id,data:this.form}),this.$message.success("设置已保存")}finally{this.loading=!1}},async handleUpdateRole({userId:e,role:l}){await this.updateMemberRole({circleId:this.currentCircle.id,userId:e,role:l}),this.$message.success("成员权限已更新")},async handleDeleteCircle(){this.deleting=!0;try{await this.deleteCircle(this.currentCircle.id),this.$message.success("圈子已删除"),this.$router.push("/circles")}finally{this.deleting=!1}}}},h=(0,u.A)(b,[["render",n],["__scopeId","data-v-ce2033ea"]]),p=h}}]);
//# sourceMappingURL=956.35602c2e.js.map