(()=>{var e={1322:(e,t,a)=>{"use strict";a.d(t,{A:()=>I});var s=a(6278),o=a(3814);const n={login:e=>o.A.post("/account/login",e),register:e=>o.A.post("/account/register",e),refreshToken:()=>o.A.post("/auth/token/refresh/"),getUserProfile:()=>o.A.get("/account/me"),logout:()=>{localStorage.removeItem("token")},changePassword:e=>o.A.post("/account/change-password",e),requestPasswordReset:e=>o.A.post("/account/request-password-reset",e),resetPassword:e=>o.A.post("/account/reset-password",e)},r={user:null,accessToken:localStorage.getItem("access_token")||null,refreshToken:localStorage.getItem("refresh_token")||null,isAuthenticated:!1},i={SET_TOKEN(e,{access:t,refresh:a}){e.accessToken=t,e.refreshToken=a,e.isAuthenticated=!0,localStorage.setItem("access_token",t),localStorage.setItem("refresh_token",a)},SET_USER(e,t){e.user=t,e.isAuthenticated=!0},LOGOUT(e){e.user=null,e.accessToken=null,e.refreshToken=null,e.isAuthenticated=!1,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}},c={async login({commit:e},t){try{const a=await n.login(t),s=a.data.token||a.data.access||a.data;e("SET_TOKEN",{access:s,refresh:""});const o=await n.getUserProfile();return e("SET_USER",o.data),!0}catch(a){throw e("LOGOUT"),a}},async register({commit:e},t){try{const a=await n.register(t),s=a.data.token||a.data.access||a.data;e("SET_TOKEN",{access:s,refresh:""});const o=await n.getUserProfile();return e("SET_USER",o.data),!0}catch(a){throw e("LOGOUT"),a}},async logout({commit:e}){await n.logout(),e("LOGOUT")},async getUserProfile({commit:e}){const t=await n.getUserProfile();e("SET_USER",t.data)}},u={isAuthenticated:e=>!!e.accessToken,user:e=>e.user},l={namespaced:!0,state:r,mutations:i,actions:c,getters:u},d={bookList:[],currentBook:null,recommendations:[],searchResults:[],sharedStatus:{}},m={SET_BOOKS(e,t){e.bookList=t},SET_CURRENT_BOOK(e,t){e.currentBook=t},SET_RECOMMENDATIONS(e,t){e.recommendations=t},SET_SEARCH_RESULTS(e,t){e.searchResults=t},UPDATE_SHARED_STATUS(e,{bookId:t,circles:a}){e.sharedStatus[t]=a}},h={async fetchBooks({commit:e},t){const a=await this.$booksApi.getBooks(t);e("SET_BOOKS",a.data)},async fetchBookDetail({commit:e},t){const a=await this.$booksApi.getBookDetail(t);e("SET_CURRENT_BOOK",a.data)},async searchBooks({commit:e},t){const a=await this.$booksApi.searchBooks(t);e("SET_SEARCH_RESULTS",a.data)},async shareBook({commit:e},{bookId:t,circleId:a}){await this.$booksApi.shareToCircle(t,a),e("UPDATE_SHARED_STATUS",{bookId:t,circles:[...d.sharedStatus[t]||[],a]})},async loadRecommendations({commit:e}){const t=await this.$booksApi.getRecommendations();e("SET_RECOMMENDATIONS",t.data)}},p={namespaced:!0,state:d,mutations:m,actions:h},g={getGroups:e=>o.A.get("/group",{params:e}),getGroupDetail:e=>o.A.get(`/group/${e}`),createGroup:e=>o.A.post("/group",e),editGroup:(e,t)=>o.A.put(`/group/${e}`,t),deleteGroup:e=>o.A.delete(`/group/${e}`),uploadGroupIcon:(e,t)=>{const a=new FormData;return a.append("icon",t),o.A.post(`/group/upload-icon/${e}`,a)},joinGroup:e=>o.A.post(`/group/${e}/join`),quitGroup:e=>o.A.post(`/group/${e}/leave`),getGroupMembers:e=>o.A.get(`/group/${e}/members`),getPendingMembers:e=>o.A.get(`/group/${e}/agree-join`),auditMember:(e,t,a)=>o.A.post(`/group/${e}/review/${t}/`,{isOno:a}),getDiscussions:(e,t)=>o.A.get(`/group/${e}/discussions`,{params:t}),getDiscussionDetail:(e,t)=>o.A.get(`/group/${e}/discussions/${t}`),createDiscussion:(e,t)=>o.A.post(`/group/${e}/discussions`,t),deleteDiscussion:(e,t)=>o.A.delete(`/group/${e}/discussions/${t}`),replyDiscussion:(e,t,a)=>o.A.post(`/group/${e}/discussions/${t}/reply`,a)},f=g,b={groups:[],groupDetail:null,members:[],pendingMembers:[],discussions:[],discussionDetail:null},S={SET_GROUPS(e,t){e.groups=t},SET_GROUP_DETAIL(e,t){e.groupDetail=t},SET_MEMBERS(e,t){e.members=t},SET_PENDING_MEMBERS(e,t){e.pendingMembers=t},SET_DISCUSSIONS(e,t){e.discussions=t},SET_DISCUSSION_DETAIL(e,t){e.discussionDetail=t}},A={async fetchGroups({commit:e},t){const a=await f.getGroups(t);a.success&&e("SET_GROUPS",a.data?.groups||a.data?.list||[])},async fetchGroupDetail({commit:e},t){const a=await f.getGroupDetail(t);a.success&&e("SET_GROUP_DETAIL",a.data)},async fetchMembers({commit:e},t){const a=await f.getGroupMembers(t);a.success&&e("SET_MEMBERS",a.data)},async fetchPendingMembers({commit:e},t){const a=await f.getPendingMembers(t);a.success&&e("SET_PENDING_MEMBERS",a.data)},async fetchDiscussions({commit:e},{id:t,params:a}){const s=await f.getDiscussions(t,a);s.success&&e("SET_DISCUSSIONS",s.data?.discussions||s.data?.list||[])},async fetchDiscussionDetail({commit:e},{id:t,discussionId:a}){const s=await f.getDiscussionDetail(t,a);s.success&&e("SET_DISCUSSION_DETAIL",s.data)},clearGroupDetail({commit:e}){e("SET_GROUP_DETAIL",null),e("SET_MEMBERS",[]),e("SET_PENDING_MEMBERS",[]),e("SET_DISCUSSIONS",[]),e("SET_DISCUSSION_DETAIL",null)}},E={groups:e=>e.groups,groupDetail:e=>e.groupDetail,members:e=>e.members,pendingMembers:e=>e.pendingMembers,discussions:e=>e.discussions,discussionDetail:e=>e.discussionDetail},T={namespaced:!0,state:b,mutations:S,actions:A,getters:E};var _=a(9252),k=a.n(_);const y={getChatList:()=>o.A.get("/chat"),getMessages:(e,t)=>o.A.get(`/chat/${e}`,{params:t}),sendMessage:(e,t)=>o.A.post("/chat",{receiver_id:e,content:t})},v=y,w={chatList:[],messages:{},currentPartner:null},D={SET_CHAT_LIST(e,t){e.chatList=t},SET_MESSAGES(e,{partnerId:t,messages:a}){e.messages={...e.messages,[t]:a}},ADD_MESSAGE(e,{partnerId:t,message:a}){e.messages[t]||(e.messages[t]=[]),e.messages[t].push(a)},SET_CURRENT_PARTNER(e,t){e.currentPartner=t}},C={async fetchChatList({commit:e}){const t=await v.getChatList();t.success&&e("SET_CHAT_LIST",t.data)},async fetchMessages({commit:e},{partnerId:t,params:a}){const s=await v.getMessages(t,a);s.success&&e("SET_MESSAGES",{partnerId:t,messages:s.data.messages||s.data.list||[]})},async sendMessage({commit:e},{receiver_id:t,content:a}){const s=await v.sendMessage(t,a);return s.success&&e("ADD_MESSAGE",{partnerId:t,message:s.data}),s},setCurrentPartner({commit:e},t){e("SET_CURRENT_PARTNER",t)}},O={chatList:e=>e.chatList,messages:e=>t=>e.messages[t]||[],currentPartner:e=>e.currentPartner},R={namespaced:!0,state:w,mutations:D,actions:C,getters:O},I=(0,s.y$)({modules:{auth:l,books:p,circle:T,comments:k(),chat:R},strict:!1})},3814:(e,t,a)=>{"use strict";a.d(t,{A:()=>i});var s=a(2505),o=a.n(s),n=a(1322);const r=o().create({baseURL:"http://localhost:8000",timeout:1e4});r.interceptors.request.use((e=>{const t=n.A.state.auth.accessToken;return t&&(e.headers.Authorization=`Bearer ${t}`),e})),r.interceptors.response.use((e=>e.data),(async e=>{const t=e.config;if(401===e.response.status&&!t._retry){t._retry=!0;try{const e=await n.A.dispatch("auth/refreshToken");return t.headers.Authorization=`Bearer ${e}`,r(t)}catch(a){return n.A.commit("auth/LOGOUT"),Promise.reject(a)}}return Promise.reject(e)}));const i=r},4672:(e,t,a)=>{"use strict";var s=a(3751),o=a(641);function n(e,t,a,s,n,r){const i=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.Wv)(i)}const r={name:"App"};var i=a(6262);const c=(0,i.A)(r,[["render",n]]),u=c;var l=a(5220);const d=[{path:"/login",name:"Login",component:()=>a.e(893).then(a.bind(a,1893)),meta:{layout:"AuthLayout",requiresAuth:!1}},{path:"/register",name:"Register",component:()=>a.e(15).then(a.bind(a,2015)),meta:{layout:"AuthLayout",requiresAuth:!1}}],m=[{path:"/books",name:"BookExplore",component:()=>a.e(540).then(a.bind(a,5540)),meta:{requiresAuth:!0}},{path:"/books/:id",name:"BookDetail",component:()=>a.e(618).then(a.bind(a,6618)),meta:{requiresAuth:!0},props:!0},{path:"/recommendations",name:"Recommendations",component:()=>a.e(948).then(a.bind(a,7948)),meta:{requiresAuth:!0}},{path:"/shared-books",name:"SharedBooks",component:()=>a.e(810).then(a.bind(a,4810)),meta:{requiresAuth:!0}}],h=[{path:"/circle/:id",name:"CircleHome",component:()=>a.e(395).then(a.bind(a,395)),meta:{requiresAuth:!0},props:!0,children:[{path:"discussion",name:"CircleDiscussion",component:()=>a.e(582).then(a.bind(a,6582))},{path:"library",name:"CircleLibrary",component:()=>a.e(71).then(a.bind(a,2071))},{path:"settings",name:"CircleSettings",component:()=>a.e(956).then(a.bind(a,2956))}]}],p=[{path:"/comments/:id",name:"CommentDetail",component:()=>a.e(89).then(a.bind(a,6089)),meta:{requiresAuth:!0,scrollToComment:!0}}];var g=a(33);const f={class:"notifications-view"},b={class:"actions"};function S(e,t,a,s,n,r){const i=(0,o.g2)("el-tab-pane"),c=(0,o.g2)("el-tabs"),u=(0,o.g2)("el-button"),l=(0,o.g2)("el-table-column"),d=(0,o.g2)("el-tag"),m=(0,o.g2)("el-table");return(0,o.uX)(),(0,o.CE)("div",f,[t[3]||(t[3]=(0,o.Lk)("h2",null,"通知中心",-1)),(0,o.bF)(c,{modelValue:n.activeTab,"onUpdate:modelValue":t[0]||(t[0]=e=>n.activeTab=e),onTabClick:r.handleTabChange},{default:(0,o.k6)((()=>[(0,o.bF)(i,{label:"全部",name:"all"}),(0,o.bF)(i,{label:"系统",name:"system"}),(0,o.bF)(i,{label:"评论",name:"comment"}),(0,o.bF)(i,{label:"圈子",name:"circle"})])),_:1},8,["modelValue","onTabClick"]),(0,o.Lk)("div",b,[(0,o.bF)(u,{size:"small",onClick:r.markAllAsRead,loading:n.markingAll},{default:(0,o.k6)((()=>t[1]||(t[1]=[(0,o.eW)(" 全部已读 ")]))),_:1,__:[1]},8,["onClick","loading"])]),(0,o.bF)(m,{data:n.notifications,style:{width:"100%"}},{default:(0,o.k6)((()=>[(0,o.bF)(l,{prop:"title",label:"通知"}),(0,o.bF)(l,{prop:"created_at",label:"时间",width:"180"}),(0,o.bF)(l,{label:"状态",width:"100"},{default:(0,o.k6)((({row:e})=>[(0,o.bF)(d,{size:"small",type:e.read?"":"danger"},{default:(0,o.k6)((()=>[(0,o.eW)((0,g.v_)(e.read?"已读":"未读"),1)])),_:2},1032,["type"])])),_:1}),(0,o.bF)(l,{label:"操作",width:"120"},{default:(0,o.k6)((({row:e})=>[e.read?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(u,{key:0,size:"mini",onClick:t=>r.markAsRead(e.id)},{default:(0,o.k6)((()=>t[2]||(t[2]=[(0,o.eW)(" 标记已读 ")]))),_:2,__:[2]},1032,["onClick"]))])),_:1})])),_:1},8,["data"])])}var A=a(6278);const E={name:"NotificationsView",data(){return{activeTab:"all",notifications:[],markingAll:!1,loading:!1}},computed:{...(0,A.aH)("notifications",["unreadCount"])},created(){this.fetchNotifications()},methods:{...(0,A.i0)("notifications",["fetchNotifications","fetchByType","markAsRead","markAllAsRead"]),async fetchNotifications(){this.loading=!0;try{"all"===this.activeTab?await this.fetchNotifications():await this.fetchByType(this.activeTab)}finally{this.loading=!1}},handleTabChange(){this.fetchNotifications()},async markAsRead(e){await this.markAsRead(e),this.fetchNotifications()},async markAllAsRead(){this.markingAll=!0;try{await this.markAllAsRead(),this.fetchNotifications()}finally{this.markingAll=!1}}}},T=(0,i.A)(E,[["render",S],["__scopeId","data-v-4d68f7af"]]),_=T,k=[{path:"/notifications",name:"Notifications",component:_,meta:{requiresAuth:!0,title:"通知中心"}}];var y=a(1322);function v(e,t,a){const s=y.A.getters["auth/isAuthenticated"];e.matched.some((e=>e.meta.requiresAuth))?s?a():a({path:"/login",query:{redirect:e.fullPath}}):"/login"!==e.path&&"/register"!==e.path||!s?a():a({path:"/"})}function w(e){return(t,a,s)=>{const o=store.state.auth.user?.role;e.includes(o)?s():s("/forbidden")}}const D=[{path:"/",name:"Home",component:()=>a.e(532).then(a.bind(a,6532)),meta:{requiresAuth:!0}},{path:"/circle",name:"CircleList",component:()=>a.e(722).then(a.bind(a,722)),meta:{requiresAuth:!0}},...d,...m,...h,...p,...k,{path:"/profile/student",component:()=>a.e(269).then(a.bind(a,269)),meta:{requiresAuth:!0},beforeEnter:v},{path:"/profile/mentor",component:()=>a.e(58).then(a.bind(a,9058)),meta:{requiresAuth:!0},beforeEnter:v},{path:"/:pathMatch(.*)*",component:()=>a.e(715).then(a.bind(a,2715))}],C=(0,l.aE)({history:(0,l.LA)(),routes:D});C.beforeEach(v),C.beforeEach(w);const O=C;window.addEventListener("unhandledrejection",(function(e){alert("发生网络或系统错误，请稍后重试"),e.preventDefault()}));const R=(0,s.Ef)(u);R.use(y.A),R.use(O),R.mount("#app")},9252:()=>{new Map}},t={};function a(s){var o=t[s];if(void 0!==o)return o.exports;var n=t[s]={exports:{}};return e[s](n,n.exports,a),n.exports}a.m=e,(()=>{var e=[];a.O=(t,s,o,n)=>{if(!s){var r=1/0;for(l=0;l<e.length;l++){for(var[s,o,n]=e[l],i=!0,c=0;c<s.length;c++)(!1&n||r>=n)&&Object.keys(a.O).every((e=>a.O[e](s[c])))?s.splice(c--,1):(i=!1,n<r&&(r=n));if(i){e.splice(l--,1);var u=o();void 0!==u&&(t=u)}}return t}n=n||0;for(var l=e.length;l>0&&e[l-1][2]>n;l--)e[l]=e[l-1];e[l]=[s,o,n]}})(),(()=>{a.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return a.d(t,{a:t}),t}})(),(()=>{a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}})(),(()=>{a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,s)=>(a.f[s](e,t),t)),[]))})(),(()=>{a.u=e=>"js/"+e+"."+{15:"d6ae07c4",58:"8442aaf8",71:"d0e78db3",89:"d4993f13",269:"a8f9b05a",395:"36249b2c",532:"6fe683d0",540:"f969c441",582:"44133e5d",618:"c3f8fb33",715:"d6306353",722:"88858af6",810:"372fc777",893:"793474ce",948:"501d1dbc",956:"35602c2e"}[e]+".js"})(),(()=>{a.miniCssF=e=>"css/"+e+"."+{15:"879685b7",58:"e3e4e745",71:"26310d88",89:"653a5474",269:"d8121d96",395:"8341cb01",532:"03b0e715",540:"4d9e19e8",582:"4d0dde6e",618:"ab129f28",715:"d27c39e6",722:"3b090eff",810:"4080c2f2",893:"49651b41",956:"c897ca98"}[e]+".css"})(),(()=>{a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="frontend:";a.l=(s,o,n,r)=>{if(e[s])e[s].push(o);else{var i,c;if(void 0!==n)for(var u=document.getElementsByTagName("script"),l=0;l<u.length;l++){var d=u[l];if(d.getAttribute("src")==s||d.getAttribute("data-webpack")==t+n){i=d;break}}i||(c=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,a.nc&&i.setAttribute("nonce",a.nc),i.setAttribute("data-webpack",t+n),i.src=s),e[s]=[o];var m=(t,a)=>{i.onerror=i.onload=null,clearTimeout(h);var o=e[s];if(delete e[s],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(a))),t)return t(a)},h=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),c&&document.head.appendChild(i)}}})(),(()=>{a.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{a.p="/"})(),(()=>{if("undefined"!==typeof document){var e=(e,t,s,o,n)=>{var r=document.createElement("link");r.rel="stylesheet",r.type="text/css",a.nc&&(r.nonce=a.nc);var i=a=>{if(r.onerror=r.onload=null,"load"===a.type)o();else{var s=a&&a.type,i=a&&a.target&&a.target.href||t,c=new Error("Loading CSS chunk "+e+" failed.\n("+s+": "+i+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=s,c.request=i,r.parentNode&&r.parentNode.removeChild(r),n(c)}};return r.onerror=r.onload=i,r.href=t,s?s.parentNode.insertBefore(r,s.nextSibling):document.head.appendChild(r),r},t=(e,t)=>{for(var a=document.getElementsByTagName("link"),s=0;s<a.length;s++){var o=a[s],n=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(n===e||n===t))return o}var r=document.getElementsByTagName("style");for(s=0;s<r.length;s++){o=r[s],n=o.getAttribute("data-href");if(n===e||n===t)return o}},s=s=>new Promise(((o,n)=>{var r=a.miniCssF(s),i=a.p+r;if(t(r,i))return o();e(s,i,null,o,n)})),o={524:0};a.f.miniCss=(e,t)=>{var a={15:1,58:1,71:1,89:1,269:1,395:1,532:1,540:1,582:1,618:1,715:1,722:1,810:1,893:1,956:1};o[e]?t.push(o[e]):0!==o[e]&&a[e]&&t.push(o[e]=s(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))}}})(),(()=>{var e={524:0};a.f.j=(t,s)=>{var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)s.push(o[2]);else{var n=new Promise(((a,s)=>o=e[t]=[a,s]));s.push(o[2]=n);var r=a.p+a.u(t),i=new Error,c=s=>{if(a.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var n=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;i.message="Loading chunk "+t+" failed.\n("+n+": "+r+")",i.name="ChunkLoadError",i.type=n,i.request=r,o[1](i)}};a.l(r,c,"chunk-"+t,t)}},a.O.j=t=>0===e[t];var t=(t,s)=>{var o,n,[r,i,c]=s,u=0;if(r.some((t=>0!==e[t]))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(c)var l=c(a)}for(t&&t(s);u<r.length;u++)n=r[u],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(l)},s=self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var s=a.O(void 0,[504],(()=>a(4672)));s=a.O(s)})();
//# sourceMappingURL=app.d1292197.js.map